import{l as j,r as u,u as L,g as ce,b as p,c as J,H as B,f as s,t as o,M as de,a as x,n as y,O as I,P as z,F as O,d as A,N as Y,I as pe,Q as ve,o as d,K as Z}from"./vendor-DokIFdLQ.js";import{u as me,b as D}from"./index-DaQrArxD.js";import{_ as xe,a as be}from"./DesktopNav-DHlvEWe_.js";import{C as he}from"./CustomSelect-Cuk4tAr6.js";import{S as f}from"./SkeletonLoader-r6uUC3mq.js";import{g as ye}from"./coinLogos-BjOeNWjs.js";/* empty css                                                                       */const ee=["BTC","ETH","BNB","XRP","ADA","DOGE","DOT","LTC","BCH","ETC","NEO","IOTA","LUNA"],fe={class:"min-h-screen"},we={class:"md:flex"},ke={class:"flex-1 pb-16 md:pb-0"},ge={class:"px-3 py-2 border-b border-white/10"},_e={class:"mb-2"},$e={class:"text-base font-bold text-white"},Ce={class:"flex items-center gap-3 py-2"},Fe={class:"flex-1 text-center text-white font-semibold text-base"},Se={class:"p-2 md:p-4"},Te={key:0,class:"flex flex-row gap-2 md:gap-3 items-stretch"},Be={class:"flex-1 min-w-0 max-w-[50%] flex flex-col gap-3"},De={class:"flex-1 min-w-0 max-w-[50%] flex flex-col gap-3"},Ue={key:1,class:"flex flex-row gap-2 md:gap-3 items-stretch"},Me={class:"flex-1 min-w-0 max-w-[50%] flex flex-col h-full"},Ne={class:"flex gap-2 mb-3 items-center"},Ee={class:"mb-2"},Ve={class:"mb-2"},qe={class:"block text-xs text-white/70 mb-1"},Pe={class:"flex items-center gap-1.5"},je={class:"mb-2"},Le={class:"block text-xs text-white/70 mb-1"},Ie={class:"flex items-center gap-1 mb-1"},ze={class:"flex items-center gap-0.5 border-l border-white/20 pl-1.5 flex-shrink-0"},Oe={class:"mb-1"},Ae={class:"flex justify-end mb-1"},Qe={class:"mb-3 space-y-0.5"},He={class:"flex justify-between text-xs"},Re={class:"text-white truncate ml-2"},We={class:"flex justify-between text-xs"},Ge={class:"text-white truncate ml-2"},Ke=["disabled"],Xe={class:"flex-1 min-w-0 max-w-[50%] flex flex-col h-full"},Je={class:"flex gap-2 mb-3 items-center"},Ye={class:"flex-1 text-center"},Ze={class:"text-sm md:text-base font-bold text-blue-400 truncate"},et={class:"mb-2"},tt={class:"flex justify-between text-xs text-white/60 mb-1"},st={class:"space-y-0 max-h-32 md:max-h-48 overflow-y-auto"},lt=["onClick"],ot={class:"relative z-10 text-red-400 font-medium text-xs truncate"},at={class:"relative z-10 text-white/70 text-xs truncate"},rt={class:"border-t border-b border-white/10 py-1.5 my-1 text-center"},it={class:"text-xs font-bold text-blue-400 truncate"},nt={class:"space-y-0 max-h-32 md:max-h-48 overflow-y-auto"},ut=["onClick"],ct={class:"relative z-10 text-blue-400 font-medium text-xs truncate"},dt={class:"relative z-10 text-white/70 text-xs truncate"},pt={class:"mt-3"},vt={class:"flex border-b border-white/10 mb-4"},mt={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-400"},xt={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-400"},bt={class:"relative glass-card w-full md:w-96 md:max-w-md rounded-b-2xl md:rounded-b-2xl shadow-2xl max-h-[80vh] flex flex-col animate-slide-up"},ht={class:"sticky top-0 glass-card-no-hover border-b border-white/10 px-4 py-4 z-10"},yt={class:"flex items-center justify-between"},ft={class:"flex-1 overflow-y-auto"},wt=["onClick"],kt={class:"flex items-center gap-3 flex-1 min-w-0"},gt=["src","alt"],_t={class:"text-white font-medium"},$t={class:"flex items-center gap-4 flex-shrink-0"},Ct={class:"text-white font-medium text-sm min-w-[80px] text-right"},qt={__name:"Spot",setup(Ft){const{t:St}=me(),N=ve(),Q=j(()=>window.innerWidth<768),F=ee.map(t=>`${t}/USDT`),v=u((()=>{if(N.query.symbol){let t=N.query.symbol.trim();if(t.includes("/")){if(F.includes(t))return t}else if(t=t.replace(/USDT$/,"/USDT"),F.includes(t))return t}return F[0]||"BTC/USDT"})()),c=u("buy"),w=u("market"),n=u(""),i=u(""),E=u("currency"),g=u(0),U=u(!1),_=u(!1),$=u("current"),m=u(null),k=u({bids:[],asks:[]}),V=u([]),q=u(!0),H=u([]),S=j(()=>{try{if(c.value==="buy"){const t=V.value.find(l=>l.currency==="USDT"&&(l.account_type==="spot"||!l.account_type));if(!t)return 0;const e=parseFloat(t.balance)||0,a=parseFloat(t.locked_balance)||0,r=Math.max(0,e-a);return isNaN(r)?0:r}else{const t=v.value.split("/")[0];if(!t)return 0;const e=V.value.find(h=>h.currency===t&&(h.account_type==="spot"||!h.account_type));if(!e)return 0;const a=parseFloat(e.balance)||0,r=parseFloat(e.locked_balance)||0,l=Math.max(0,a-r);return isNaN(l)?0:l}}catch(t){return console.error("Error calculating usable balance:",t),0}}),te=j(()=>{var t,e;return!i.value||!n.value?0:c.value==="buy"?parseFloat(i.value)*parseFloat(n.value||((t=m.value)==null?void 0:t.price)||0):parseFloat(i.value)*parseFloat(n.value||((e=m.value)==null?void 0:e.price)||0)}),b=t=>t?t>=1?t.toFixed(2):t>=.01?t.toFixed(4):t.toFixed(8):"0.00",R=t=>t?parseFloat(t).toFixed(4):"0.0000",C=t=>{if(t==null||isNaN(t))return"0.00";const e=parseFloat(t);return isNaN(e)?"0.00":e>=1?e.toFixed(2):e>=.01?e.toFixed(4):e.toFixed(8)},se=t=>{v.value=t,_.value=!1,T()},le=t=>{const e=t.split("/")[0];return ye(e)||`https://via.placeholder.com/32?text=${e}`},oe=t=>{const e=t.target.alt.split("/")[0];t.target.src=`https://via.placeholder.com/32?text=${e}`},ae=async()=>{try{const t=ee.map(async a=>{try{const r=`${a}USDT`,l=await D.get(`/market/ticker/${r}/24h`);return l.data&&l.data.price?{symbol:`${a}/USDT`,price:l.data.price,change:l.data.priceChangePercent||0}:null}catch(r){return console.debug(`Failed to fetch ${a}:`,r.message),null}}),e=await Promise.all(t);H.value=e.filter(Boolean).sort((a,r)=>a.symbol.localeCompare(r.symbol))}catch(t){console.error("Error loading coin list:",t)}},P=t=>{var e;if(E.value=t,t==="all"){if(c.value==="buy"){const a=S.value/parseFloat(n.value||((e=m.value)==null?void 0:e.price)||1);i.value=C(a)}else i.value=C(S.value);g.value=100}},re=()=>{var e;const t=g.value/100;if(c.value==="buy"){const a=S.value/parseFloat(n.value||((e=m.value)==null?void 0:e.price)||1);i.value=C(a*t)}else i.value=C(S.value*t)},W=(t,e)=>{n.value=b(t),e!==c.value&&(c.value=e)},G=(t,e)=>{if(!k.value.bids.length||!k.value.asks.length)return 0;const a=e==="bid"?k.value.bids.map(l=>parseFloat(l.quantity)):k.value.asks.map(l=>parseFloat(l.quantity)),r=Math.max(...a);return r===0?0:parseFloat(t)/r*100},T=async()=>{q.value=!0;const t=v.value.replace("/","");try{await Promise.all([K(t),X(t),M()])}finally{q.value=!1}},K=async t=>{try{const e=await D.get(`/market/ticker/${t}/24h`);m.value=e.data,w.value==="market"&&!n.value&&(n.value=b(m.value.price))}catch(e){console.error("Error loading ticker:",e)}},X=async t=>{try{const e=await D.get(`/market/orderbook/${t}`,{params:{limit:12}});k.value=e.data}catch(e){console.error("Error loading order book:",e)}},M=async()=>{try{const t=await D.get("/wallet",{params:{account_type:"spot"}});V.value=(t.data.wallets||[]).map(e=>({...e,account_type:e.account_type||"spot"}))}catch(t){console.error("Error loading wallets:",t)}},ie=async()=>{var t,e,a;if(!i.value||parseFloat(i.value)<=0){alert("Please enter a valid quantity");return}if(w.value==="limit"&&(!n.value||parseFloat(n.value)<=0)){alert("Please enter a valid price");return}U.value=!0;try{await D.post("/orders",{symbol:v.value,side:c.value,type:w.value,quantity:parseFloat(i.value),price:w.value==="limit"?parseFloat(n.value):(t=m.value)==null?void 0:t.price}),alert("Order placed successfully!"),i.value="",n.value="",g.value=0,M(),T()}catch(r){alert(((a=(e=r.response)==null?void 0:e.data)==null?void 0:a.error)||"Failed to place order")}U.value=!1};L(()=>N.query.symbol,t=>{if(t){let e=t.trim();e.includes("/")||(e=e.replace(/USDT$/,"/USDT")),F.includes(e)&&(v.value=e,T())}},{immediate:!0}),L(w,t=>{var e;t==="market"&&((e=m.value)!=null&&e.price)&&(n.value=b(m.value.price))}),L(c,()=>{i.value="",g.value=0,M()});const ne=async()=>{const t=v.value.replace("/","");await Promise.all([K(t),X(t)])};return ce(()=>{T(),ae();let t=!1,e=0;setInterval(async()=>{if(!t){t=!0;try{await ne(),e=(e+1)%5,e===0&&await M()}catch(a){console.error("Error refreshing market data:",a)}finally{t=!1}}},2e3)}),(t,e)=>{var a,r;return d(),p("div",fe,[Q.value?(d(),J(xe,{key:0})):B("",!0),s("div",we,[Q.value?B("",!0):(d(),J(be,{key:0})),s("main",ke,[s("div",ge,[s("div",_e,[s("h1",$e,o(t.$t("spot.title")),1)]),s("div",Ce,[s("button",{onClick:e[0]||(e[0]=l=>_.value=!0),class:"p-1.5 hover:opacity-80 transition-opacity"},[...e[16]||(e[16]=[s("svg",{class:"w-5 h-5 text-white/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),s("span",Fe,o(v.value),1),s("button",{onClick:e[1]||(e[1]=l=>t.$router.push({path:"/kline",query:{symbol:v.value}})),class:"p-1.5 hover:opacity-80 transition-opacity"},[...e[17]||(e[17]=[de('<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"><rect x="2" y="14" width="4" height="6" fill="#10B981"></rect><line x1="4" y1="12" x2="4" y2="14" stroke="#10B981" stroke-width="1.5" stroke-linecap="round"></line><line x1="4" y1="20" x2="4" y2="22" stroke="#10B981" stroke-width="1.5" stroke-linecap="round"></line><rect x="9" y="10" width="4" height="10" fill="#EF4444"></rect><line x1="11" y1="8" x2="11" y2="10" stroke="#EF4444" stroke-width="1.5" stroke-linecap="round"></line><line x1="11" y1="20" x2="11" y2="22" stroke="#EF4444" stroke-width="1.5" stroke-linecap="round"></line><rect x="16" y="14" width="4" height="6" fill="#10B981"></rect><line x1="18" y1="12" x2="18" y2="14" stroke="#10B981" stroke-width="1.5" stroke-linecap="round"></line><line x1="18" y1="20" x2="18" y2="22" stroke="#10B981" stroke-width="1.5" stroke-linecap="round"></line></svg>',1)])])])]),s("div",Se,[q.value?(d(),p("div",Te,[s("div",Be,[x(f,{type:"button"}),x(f,{type:"input"}),x(f,{type:"input"}),x(f,{type:"input"}),x(f,{type:"button"})]),s("div",De,[x(f,{type:"button"}),x(f,{type:"order-book",rows:6}),e[18]||(e[18]=s("div",{class:"h-px bg-white/10 my-1"},null,-1)),x(f,{type:"order-book",rows:6})])])):(d(),p("div",Ue,[s("div",Me,[s("div",Ne,[s("button",{onClick:e[2]||(e[2]=l=>c.value="buy"),class:y(["flex-1 py-2 rounded-lg font-medium transition-colors",c.value==="buy"?"bg-blue-500/20 text-blue-300":"bg-white/5 text-white/60 hover:bg-white/10"])},o(t.$t("spot.buy")),3),s("button",{onClick:e[3]||(e[3]=l=>c.value="sell"),class:y(["flex-1 py-2 rounded-lg font-medium transition-colors",c.value==="sell"?"bg-red-500/20 text-red-300":"bg-white/5 text-white/60 hover:bg-white/10"])},o(t.$t("spot.sell")),3)]),s("div",Ee,[e[19]||(e[19]=s("label",{class:"block text-xs text-white/70 mb-1"},"Transaction mode",-1)),x(he,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),options:[{value:"market",label:"Market"},{value:"limit",label:"Limit"}]},null,8,["modelValue"])]),s("div",Ve,[s("label",qe,o(t.$t("spot.price")),1),s("div",Pe,[I(s("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.value=l),type:"number",step:"0.00000001",class:"flex-1 min-w-0 px-2 py-1.5 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-blue-500/50 text-sm text-white",placeholder:"Market optimal price"},null,512),[[z,n.value]]),e[20]||(e[20]=s("span",{class:"text-white/70 text-xs whitespace-nowrap flex-shrink-0"},"USDT",-1))]),e[21]||(e[21]=s("p",{class:"text-xs text-white/60 mt-0.5"},"Market optimal price",-1))]),s("div",je,[s("label",Le,o(t.$t("spot.quantity")),1),s("div",Ie,[I(s("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>i.value=l),type:"number",step:"0.00000001",class:"flex-1 min-w-0 px-2 py-1.5 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-blue-500/50 text-sm text-white",placeholder:"0"},null,512),[[z,i.value]]),s("div",ze,[s("button",{onClick:e[7]||(e[7]=l=>P("currency")),class:y(["px-1.5 py-0.5 rounded text-xs transition-colors whitespace-nowrap",E.value==="currency"?"bg-white/20 text-white":"text-white/60 hover:text-white"])},o(v.value.split("/")[0]),3),e[22]||(e[22]=s("span",{class:"text-white/40"},"|",-1)),s("button",{onClick:e[8]||(e[8]=l=>P("all")),class:y(["px-1.5 py-0.5 rounded text-xs transition-colors whitespace-nowrap",E.value==="all"?"bg-white/20 text-white":"text-white/60 hover:text-white"])}," all ",2)])]),s("div",Oe,[I(s("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>g.value=l),type:"range",min:"0",max:"100",step:"1",class:"w-full h-1.5 bg-white/10 rounded-lg appearance-none cursor-pointer",onInput:re},null,544),[[z,g.value]])]),s("div",Ae,[s("button",{onClick:e[10]||(e[10]=l=>P("all")),class:"px-2 py-0.5 text-xs text-white/70 hover:text-white transition-colors"}," Max ")])]),s("div",Qe,[s("div",He,[e[23]||(e[23]=s("span",{class:"text-white/70"},"Usable",-1)),s("span",Re,o(C(S.value))+" USDT",1)]),s("div",We,[e[24]||(e[24]=s("span",{class:"text-white/70"},"Volume",-1)),s("span",Ge,o(C(te.value))+" USDT",1)])]),s("button",{onClick:ie,disabled:U.value||!i.value||parseFloat(i.value)<=0,class:y(["w-full py-2.5 rounded-lg font-bold text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm",c.value==="buy"?"bg-blue-500 hover:bg-blue-600 active:bg-blue-700":"bg-red-500 hover:bg-red-600 active:bg-red-700"])},o(U.value?t.$t("common.loading"):`${c.value==="buy"?t.$t("spot.buy"):t.$t("spot.sell")} ${v.value.split("/")[0]}`),11,Ke)]),s("div",Xe,[s("div",Je,[e[25]||(e[25]=s("div",{class:"flex-1"},null,-1)),s("div",Ye,[s("div",Ze,o(b(((a=m.value)==null?void 0:a.price)||0))+" USDT",1)]),e[26]||(e[26]=s("div",{class:"flex-1"},null,-1))]),s("div",et,[s("div",tt,[s("span",null,o(t.$t("spot.price")),1),s("span",null,o(t.$t("spot.quantity")),1)]),s("div",st,[(d(!0),p(O,null,A(k.value.asks.slice(0,6).reverse(),(l,h)=>(d(),p("div",{key:`ask-${h}`,class:"relative flex justify-between items-center text-xs cursor-pointer hover:bg-white/5 py-0.5 px-1",onClick:ue=>W(l.price,"sell")},[s("div",{class:"absolute left-0 top-0 bottom-0 bg-red-500/10 transition-all",style:Z({width:`${G(l.quantity,"ask")}%`})},null,4),s("span",ot,o(b(l.price)),1),s("span",at,o(R(l.quantity)),1)],8,lt))),128))])]),s("div",rt,[s("div",it,o(b(((r=m.value)==null?void 0:r.price)||0))+" USDT",1)]),s("div",null,[s("div",nt,[(d(!0),p(O,null,A(k.value.bids.slice(0,6),(l,h)=>(d(),p("div",{key:`bid-${h}`,class:"relative flex justify-between items-center text-xs cursor-pointer hover:bg-white/5 py-0.5 px-1",onClick:ue=>W(l.price,"buy")},[s("div",{class:"absolute left-0 top-0 bottom-0 bg-blue-500/10 transition-all",style:Z({width:`${G(l.quantity,"bid")}%`})},null,4),s("span",ct,o(b(l.price)),1),s("span",dt,o(R(l.quantity)),1)],8,ut))),128))])])])])),s("div",pt,[s("div",vt,[s("button",{onClick:e[11]||(e[11]=l=>$.value="current"),class:y(["px-4 py-2 text-sm font-medium transition-all relative",$.value==="current"?"text-blue-400":"text-white/60"])},[Y(o(t.$t("spot.current"))+" ",1),$.value==="current"?(d(),p("span",mt)):B("",!0)],2),s("button",{onClick:e[12]||(e[12]=l=>$.value="history"),class:y(["px-4 py-2 text-sm font-medium transition-all relative",$.value==="history"?"text-blue-400":"text-white/60"])},[Y(o(t.$t("spot.history"))+" ",1),$.value==="history"?(d(),p("span",xt)):B("",!0)],2)]),e[27]||(e[27]=s("div",{class:"text-center py-12"},[s("svg",{class:"w-16 h-16 text-white/30 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})]),s("p",{class:"text-white/60"},"No data")],-1))])])])]),_.value?(d(),p("div",{key:1,class:"fixed inset-0 z-50 flex items-end md:items-center md:justify-center",onClick:e[15]||(e[15]=pe(l=>_.value=!1,["self"]))},[s("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e[13]||(e[13]=l=>_.value=!1)}),s("div",bt,[s("div",ht,[s("div",yt,[e[29]||(e[29]=s("h2",{class:"text-lg font-bold text-white"},"USDT",-1)),s("button",{onClick:e[14]||(e[14]=l=>_.value=!1),class:"p-2 hover:bg-white/10 rounded-full transition-colors"},[...e[28]||(e[28]=[s("svg",{class:"w-5 h-5 text-white/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),s("div",ft,[(d(!0),p(O,null,A(H.value,l=>(d(),p("div",{key:l.symbol,onClick:h=>se(l.symbol),class:"flex items-center justify-between px-4 py-3 hover:bg-white/5 active:bg-white/10 transition-colors cursor-pointer border-b border-white/10"},[s("div",kt,[s("img",{src:le(l.symbol),alt:l.symbol,class:"w-8 h-8 rounded-full flex-shrink-0",onError:oe},null,40,gt),s("span",_t,o(l.symbol.split("/")[0]),1)]),s("div",$t,[s("span",{class:y(["text-sm font-medium",l.change>=0?"text-green-400":"text-red-400"])},o(l.change>=0?"+":"")+o(l.change.toFixed(2))+"% ",3),s("span",Ct,o(b(l.price)),1)])],8,wt))),128))])])])):B("",!0)])}}};export{qt as default};
