import{l as Z,r as y,u as be,g as we,B as ye,b as p,f as r,t as n,n as D,N as le,J as _,F as Y,d as ee,K as ie,Q as xe,R as oe,L as _e,o as g,v as ke,H as Ce,a as Se}from"./vendor-DokIFdLQ.js";import{_ as Te,u as Me,b as te}from"./index-DaQrArxD.js";import{S as Ee}from"./SkeletonLoader-r6uUC3mq.js";import{V as ne}from"./charts-CIWCquZQ.js";/* empty css                                                                       */const Fe={class:"min-h-screen"},De={class:"bg-gray-800/80 backdrop-blur-md border-b border-white/10 sticky top-0 z-10"},Ve={class:"px-3 py-2"},Ae={class:"flex items-center gap-2 mb-2"},Le={class:"text-base font-bold text-white flex-1 text-center"},Be={class:"flex items-start justify-between"},Pe={class:"flex-1"},We={key:0,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ne={key:1,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Re={class:"text-right text-xs space-y-1"},$e={class:"flex items-center justify-end gap-2"},Oe={class:"text-gray-400"},Ie={class:"text-white font-medium"},ze={class:"flex items-center justify-end gap-2"},Ue={class:"text-gray-400"},je={class:"text-white font-medium"},He={class:"flex items-center justify-end gap-2"},qe={class:"text-gray-400"},Ke={class:"text-white font-medium"},Qe={class:"pb-20"},Ge={class:"px-4"},Je={class:"flex gap-4 overflow-x-auto scrollbar-hide border-b border-white/10"},Xe=["onClick"],Ze={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-400"},Ye={class:"glass-card-no-hover rounded-none md:rounded-xl p-2 md:p-4 mb-3 md:mb-4 mx-0 md:mx-4"},et={key:0,class:"glass-card-no-hover rounded-none md:rounded-xl p-4 mb-4 mx-0 md:mx-4"},tt={class:"space-y-2"},st={key:1,class:"glass-card-no-hover rounded-none md:rounded-xl p-4 mb-4 mx-0 md:mx-4"},rt={class:"font-bold text-white mb-3"},at={class:"overflow-x-auto"},lt={class:"w-full text-sm"},it={class:"text-gray-400 border-b border-white/10"},ot={class:"text-left py-2 px-2"},nt={class:"text-left py-2 px-2"},ct={class:"text-left py-2 px-2"},dt={class:"py-2 px-2 text-gray-300"},ut={class:"fixed bottom-0 left-0 right-0 bg-gray-800/80 backdrop-blur-md border-t border-white/10 px-3 py-2 z-20"},mt={class:"grid grid-cols-2 gap-3 max-w-md mx-auto"},ht={__name:"Kline",setup(ft){const{t:x}=Me(),O=xe(),ce=_e(),k=Z(()=>window.innerWidth<768),I=Z(()=>k.value?320:400),z=Z(()=>k.value?72:120),V=y(["BTC","ETH","BNB","XRP","ADA","DOGE","DOT","LTC","BCH","ETC","NEO","IOTA","LUNA"].map(e=>`${e}/USDT`)),w=y((()=>{if(O.query.symbol){let e=O.query.symbol.trim();if(e.includes("/")){if(V.value.includes(e))return e}else if(e=e.replace(/USDT$/,"/USDT"),V.value.includes(e))return e}return V.value[0]||"BTC/USDT"})()),W=y("1min"),de=["Realtime","1min","5min","15min","30min","1hour","1day","1week","1m"],v=y(null),se=y([]),A=y(!0),u=y(null),m=y(null);let l=null,d=null,b=null,U=null,j=null,H=null,q=null;const ue=e=>{try{if(!l||!(e!=null&&e.length))return;const t=e.length,a=k.value?55:80,o=Math.max(0,t-a),i=e[o].time,c=e[t-1].time;l.applyOptions({timeScale:{rightOffset:6,barSpacing:k.value?7:6},rightPriceScale:{autoScale:!0,scaleMargins:{top:.12,bottom:.18}}}),l.timeScale().setVisibleRange({from:i,to:c}),d&&d.timeScale().setVisibleRange({from:i,to:c})}catch(t){console.warn("applyDefaultViewport error:",t)}};let C=null,K=!0,N=!1,S=null;const R=e=>e?e>=1?e.toFixed(2):e>=.01?e.toFixed(4):e.toFixed(8):"0.00",me=e=>e?parseFloat(e).toFixed(6):"0.0000",he=e=>e?e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(2)+"K":e.toFixed(2):"0.00",fe=e=>{const t=new Date(e),a=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0");return`${a}:${o}:${i}`},re=async()=>{A.value=!0;const e=w.value.replace("/","");try{await Promise.all([Q(e),G(e),l&&b?$():Promise.resolve()])}finally{A.value=!1}};let T=null,M=null,E=null;const Q=async e=>{T&&T.abort(),T=new AbortController;try{const t=await te.get(`/market/ticker/${e}/24h`,{signal:T.signal});v.value=t.data}catch(t){if(t.name==="AbortError"||t.name==="CanceledError")return;console.error("Error loading ticker:",t)}},G=async e=>{M&&M.abort(),M=new AbortController;try{const t=await te.get(`/market/trades/${e}`,{params:{limit:50},signal:M.signal});se.value=t.data}catch(t){if(t.name==="AbortError"||t.name==="CanceledError")return;console.error("Error loading recent trades:",t)}},$=async()=>{E&&E.abort(),E=new AbortController;try{let e=0;for(;(!l||!b)&&e<10;)e>0&&(console.log("Chart not initialized yet, waiting...",e),await new Promise(s=>setTimeout(s,200))),e++;if(!l||!b){console.error("Chart still not initialized after retries");return}const t=w.value.replace("/","");let a=W.value.toLowerCase();const i={realtime:"1m","1min":"1m","5min":"5m","15min":"15m","30min":"30m","1hour":"1h","1day":"1d","1week":"1w","1m":"1M"}[a]||"1m",f=(await te.get(`/market/klines/${t}`,{params:{interval:i,limit:200},signal:E.signal})).data;if(!f||f.length===0){console.warn("No klines data received");return}const h=f.filter(s=>s&&s.time&&s.open!==void 0&&s.high!==void 0&&s.low!==void 0&&s.close!==void 0).map(s=>({time:typeof s.time=="number"?Math.floor(s.time/1e3):Math.floor(new Date(s.time).getTime()/1e3),open:parseFloat(s.open),high:parseFloat(s.high),low:parseFloat(s.low),close:parseFloat(s.close)})).filter(s=>s.time>0&&!isNaN(s.open)&&!isNaN(s.high)&&!isNaN(s.low)&&!isNaN(s.close)&&s.open>0&&s.high>0&&s.low>0&&s.close>0),F=f.map(s=>({time:Math.floor(s.time/1e3),value:parseFloat(s.volume),color:parseFloat(s.close)>=parseFloat(s.open)?"#43A047":"#E53935"})),L=J(h,5),B=J(h,10),P=J(h,20);if(b&&h.length>0?(console.log("Setting candlestick data:",h.length,"candles"),b.setData(h),b.applyOptions({visible:!0,priceLineVisible:!1,lastValueVisible:!0}),K&&h.length>0&&setTimeout(()=>{ue(h),K=!1},150)):console.warn("No candlestick data to display:",{hasSeries:!!b,dataLength:h.length}),U&&F.length>0&&d&&U.setData(F),h.length>0&&(j&&L.length>0&&j.setData(L),H&&B.length>0&&H.setData(B),q&&P.length>0&&q.setData(P)),await oe(),l&&u.value&&h.length>0){const s=u.value.clientWidth;s>0&&l.applyOptions({width:s})}if(d&&m.value&&F.length>0){const s=m.value.clientWidth;s>0&&d.applyOptions({width:s})}}catch(e){if(e.name==="AbortError"||e.name==="CanceledError")return;console.error("Error loading klines:",e)}},J=(e,t)=>{const a=[];for(let o=0;o<e.length;o++){if(o<t-1)continue;let i=0;for(let c=0;c<t;c++)i+=e[o-c].close;a.push({time:e[o].time,value:i/t})}return a},ae=e=>{const t=w.value.replace("/","");ce.push({path:"/contracts",query:{symbol:t,side:e}})},ve=async()=>{if(await oe(),u.value&&!l){let e=0;for(;(!u.value.clientWidth||u.value.clientWidth===0)&&e<10;)await new Promise(o=>setTimeout(o,50)),e++;const t=u.value.clientWidth||800;if(t===0){console.error("Chart container has no width");return}if(l=ne(u.value,{layout:{background:{color:"transparent"},textColor:"#ffffff"},grid:{vertLines:{color:"rgba(255, 255, 255, 0.1)"},horzLines:{color:"rgba(255, 255, 255, 0.1)"}},width:t,height:I.value,timeScale:{timeVisible:!0,secondsVisible:!1,rightOffset:6,barSpacing:k.value?7:6},rightPriceScale:{autoScale:!0,scaleMargins:{top:.12,bottom:.18}},watermark:{visible:!1}}),k.value,b=l.addCandlestickSeries({upColor:"#43A047",downColor:"#E53935",borderUpColor:"#43A047",borderDownColor:"#E53935",wickUpColor:"#43A047",wickDownColor:"#E53935",priceFormat:{type:"price",precision:2,minMove:.01},visible:!0,priceLineVisible:!1,lastValueVisible:!0}),j=l.addLineSeries({color:"#FF6B9D",lineWidth:2,title:"MA5"}),H=l.addLineSeries({color:"#4ECDC4",lineWidth:2,title:"MA10"}),q=l.addLineSeries({color:"#95E1D3",lineWidth:2,title:"MA20"}),m.value){let o=0;for(;(!m.value.clientWidth||m.value.clientWidth===0)&&o<10;)await new Promise(c=>setTimeout(c,50)),o++;const i=m.value.clientWidth||800;d=ne(m.value,{layout:{background:{color:"transparent"},textColor:"#ffffff"},grid:{vertLines:{visible:!1},horzLines:{color:"rgba(255, 255, 255, 0.1)"}},width:i,height:z.value,timeScale:{visible:!1},rightPriceScale:{visible:!0},watermark:{visible:!1}}),U=d.addHistogramSeries({priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}}),l.timeScale().subscribeVisibleTimeRangeChange(c=>{if(c&&d)try{const f=d.timeScale();f&&c.from&&c.to&&f.setVisibleRange(c)}catch(f){console.warn("Error syncing time scales:",f)}})}const a=()=>{u.value&&u.value.querySelectorAll('svg[class*="watermark"], svg[data-name="watermark"], .watermark, [class*="tradingview"], svg text[class*="watermark"], svg text[data-name="watermark"]').forEach(i=>{i.style.display="none",i.style.visibility="hidden",i.style.opacity="0",i.remove()}),m.value&&m.value.querySelectorAll('svg[class*="watermark"], svg[data-name="watermark"], .watermark, [class*="tradingview"], svg text[class*="watermark"], svg text[data-name="watermark"]').forEach(i=>{i.style.display="none",i.style.visibility="hidden",i.style.opacity="0",i.remove()})};setTimeout(a,100),setTimeout(a,500),setTimeout(a,1e3),u.value&&m.value&&(C=new MutationObserver(()=>{a()}),C.observe(u.value,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-name"]}),C.observe(m.value,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","data-name"]}))}};be(()=>O.query.symbol,e=>{if(e){let t=e.trim();t.includes("/")||(t=t.replace(/USDT$/,"/USDT")),V.value.includes(t)&&(w.value=t,re())}},{immediate:!0});let X=null;const pe=async()=>{var a;const e=w.value.replace("/",""),t=(a=l==null?void 0:l.timeScale())==null?void 0:a.getVisibleRange();if(await Promise.all([Q(e),G(e),$()]),!K&&N&&t&&l)try{l.timeScale().setVisibleRange(t),d&&d.timeScale().setVisibleRange(t)}catch(o){console.warn("Error restoring zoom:",o)}};return we(async()=>{await ve();const e=w.value.replace("/","");A.value=!0;try{await Promise.all([Q(e),G(e)]),l&&b&&await $()}finally{A.value=!1}S=()=>{try{if(l&&u.value){const a=u.value.clientWidth;a>0&&l.applyOptions({width:a,height:I.value})}if(d&&m.value){const a=m.value.clientWidth;a>0&&d.applyOptions({width:a,height:z.value})}}catch(a){console.warn("handleResize error:",a)}},window.addEventListener("resize",S,{passive:!0}),setTimeout(S,250);let t=!1;X=setInterval(async()=>{if(!t){t=!0;try{await pe()}catch(a){console.error("Error refreshing market data:",a)}finally{t=!1}}},2e3)}),ye(()=>{T&&T.abort(),M&&M.abort(),E&&E.abort(),C&&(C.disconnect(),C=null),X&&clearInterval(X),S&&(window.removeEventListener("resize",S),S=null),l&&l.remove(),d&&d.remove()}),(e,t)=>{var a,o,i,c,f,h,F,L,B,P;return g(),p("div",Fe,[r("div",De,[r("div",Ve,[r("div",Ae,[r("button",{onClick:t[0]||(t[0]=s=>e.$router.back()),class:"p-1.5 hover:bg-gray-700 rounded-lg transition-colors"},[...t[3]||(t[3]=[r("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),r("h1",Le,n(w.value),1),t[4]||(t[4]=r("div",{class:"w-8"},null,-1))]),r("div",Be,[r("div",Pe,[r("div",{class:D(["text-xl font-bold mb-1",((a=v.value)==null?void 0:a.priceChangePercent)>=0?"text-green-400":"text-red-400"])},n(R(((o=v.value)==null?void 0:o.price)||0)),3),r("div",{class:D(["inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium",((i=v.value)==null?void 0:i.priceChangePercent)>=0?"bg-green-500/20 text-green-300":"bg-red-500/20 text-red-300"])},[((c=v.value)==null?void 0:c.priceChangePercent)<0?(g(),p("svg",We,[...t[5]||(t[5]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])])):(g(),p("svg",Ne,[...t[6]||(t[6]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 15l7-7 7 7"},null,-1)])])),le(" "+n(((f=v.value)==null?void 0:f.priceChangePercent)>=0?"+":"")+n(((F=(h=v.value)==null?void 0:h.priceChangePercent)==null?void 0:F.toFixed(2))||"0.00")+"% ",1)],2)]),r("div",Re,[r("div",$e,[r("span",Oe,n(_(x)("kline.high")),1),r("span",Ie,n(R(((L=v.value)==null?void 0:L.highPrice)||0)),1)]),r("div",ze,[r("span",Ue,n(_(x)("kline.low")),1),r("span",je,n(R(((B=v.value)==null?void 0:B.lowPrice)||0)),1)]),r("div",He,[r("span",qe,n(_(x)("kline.volume24h")),1),r("span",Ke,n(he(((P=v.value)==null?void 0:P.volume)||0)),1)])])])])]),r("main",Qe,[r("div",Ge,[r("div",Je,[(g(),p(Y,null,ee(de,s=>r("button",{key:s,onClick:ge=>{W.value=s,ke(N)?N.value=!1:N=!1,$()},class:D(["px-2 py-2 text-xs font-medium whitespace-nowrap transition-all relative",W.value===s?"text-blue-400":"text-gray-400 hover:text-gray-300"])},[le(n(s)+" ",1),W.value===s?(g(),p("span",Ze)):Ce("",!0)],10,Xe)),64))])]),r("div",Ye,[r("div",{ref_key:"chartContainer",ref:u,class:"w-full chart-no-watermark",style:ie({height:`${I.value}px`})},null,4),r("div",{ref_key:"volumeContainer",ref:m,class:"w-full mt-2 chart-no-watermark",style:ie({height:`${z.value}px`})},null,4)]),A.value?(g(),p("div",et,[t[7]||(t[7]=r("div",{class:"h-6 bg-white/10 rounded w-32 mb-3 animate-pulse"},null,-1)),r("div",tt,[(g(),p(Y,null,ee(10,s=>Se(Ee,{key:s,type:"table-row"})),64))])])):(g(),p("div",st,[r("h3",rt,n(_(x)("kline.marketTrades")),1),r("div",at,[r("table",lt,[r("thead",null,[r("tr",it,[r("th",ot,n(_(x)("kline.time")),1),t[8]||(t[8]=r("th",{class:"text-left py-2 px-2"},"Direction",-1)),r("th",nt,n(_(x)("kline.price")),1),r("th",ct,n(_(x)("kline.quantity")),1)])]),r("tbody",null,[(g(!0),p(Y,null,ee(se.value.slice(0,20),s=>(g(),p("tr",{key:s.id,class:"border-b border-white/5"},[r("td",dt,n(fe(s.time)),1),r("td",{class:D(["py-2 px-2 font-medium",s.isBuyerMaker?"text-red-400":"text-green-400"])},n(s.isBuyerMaker?"Inbuy":"Outsell"),3),r("td",{class:D(["py-2 px-2",s.isBuyerMaker?"text-red-400":"text-green-400"])},n(R(s.price)),3),r("td",{class:D(["py-2 px-2",s.isBuyerMaker?"text-red-400":"text-green-400"])},n(me(s.quantity)),3)]))),128))])])])]))]),r("div",ut,[r("div",mt,[r("button",{onClick:t[1]||(t[1]=s=>ae("buy")),class:"bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold py-2.5 rounded-lg text-base transition-colors shadow-lg"}," Up "),r("button",{onClick:t[2]||(t[2]=s=>ae("sell")),class:"bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold py-2.5 rounded-lg text-base transition-colors shadow-lg"}," Fall ")])])])}}},_t=Te(ht,[["__scopeId","data-v-f1177ca4"]]);export{_t as default};
