import{m as j,r as u,P as G,z as L,o as X,f as i,c as M,a as m,h as e,t as r,v as c,O as Z,F as B,g as S,Q as ee,R as te,j as P,e as a,n as q}from"./vendor.BJKvz4Yw.js";import{u as se,b as U}from"./index.DnUnV9d6.js";import{_ as oe}from"./MobileNav.CRat4cih.js";import{_ as le}from"./DesktopNav.BGZcsY3O.js";const re={class:"min-h-screen"},ne={class:"md:flex"},ae={class:"flex-1 pb-16 md:pb-0"},ie={class:"glass-card-no-hover border-b border-white/10 px-4 py-3"},de={class:"flex items-center justify-between"},ue={class:"flex items-center gap-3"},ce={class:"text-lg font-bold text-white"},ve={class:"p-3 pb-4"},pe={class:"mb-4"},fe={class:"flex items-center justify-between mb-2"},he={class:"text-white font-medium"},me={key:0,class:"mb-4"},be={class:"flex gap-2"},xe=["onClick"],we={class:"rounded-xl p-4 mb-3 text-center bg-white/5 border border-white/10 min-h-[230px] flex flex-col items-center justify-center"},ge={key:0,class:"flex flex-col items-center gap-3 w-full"},_e={class:"mb-4"},ye={class:"inline-block p-3 bg-white rounded-lg relative"},ke=["src"],Ce={class:"absolute inset-0 flex items-center justify-center pointer-events-none"},Te={class:"w-10 h-10 bg-white rounded-full p-1.5 flex items-center justify-center shadow-lg"},Be=["src","alt"],De={class:"mb-2"},Re={class:"text-white/70 text-xs mb-1.5"},Ae={class:"flex items-center gap-2 justify-center"},je={class:"text-white font-mono text-xs break-all"},Se={key:2,class:"text-xs text-white/60"},Ue={class:"rounded-xl p-3 space-y-3 bg-white/5 border border-white/10"},Ne={class:"block text-xs text-white/70 mb-1.5"},Ee={class:"flex items-center gap-2"},Fe={class:"text-white/70 text-xs"},$e={class:"block text-xs text-white/70 mb-1.5"},Le=["value"],Me={key:0,class:"mt-2"},Pe=["src"],qe=["disabled"],Ke={class:"text-[11px] text-white/60 text-center leading-snug"},ze={class:"glass-card rounded-t-xl md:rounded-xl w-full max-w-md max-h-[80vh] overflow-y-auto animate-slide-up"},He={class:"sticky top-0 glass-card-no-hover border-b border-white/10 p-4 flex justify-between items-center"},Ve={class:"text-lg font-bold text-white"},Ie={class:"p-2"},Oe=["onClick"],Qe={class:"text-white font-medium"},Je={key:0,class:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},We={class:"glass-card rounded-t-xl md:rounded-xl w-full max-w-md max-h-[80vh] overflow-y-auto animate-slide-up"},Ye={class:"sticky top-0 glass-card-no-hover border-b border-white/10 p-4 flex justify-between items-center"},Ge={class:"p-4"},Xe={class:"flex justify-between items-start mb-2"},Ze={class:"text-white font-medium"},et={class:"text-white/60 text-sm"},tt={key:0,class:"text-center text-white/60 py-8"},at={__name:"Deposit",setup(st){const{t:d}=se(),K=G(),N=j(()=>window.innerWidth<768),o=u(K.query.currency||"USDT"),v=u("TRC20"),b=u(""),f=u(null),_=u(null),p=u(""),x=u(""),D=u(!1),y=u(!1),w=u(!1),k=u(!1),C=u([]),E=u(null),z=[{value:"BTC",label:"BTC"},{value:"USDT",label:"USDT"},{value:"ETH",label:"ETH"},{value:"BANK",label:"P2P Bank transfer"}],R=j(()=>o.value==="USDT"?["TRC20","ERC20"]:o.value==="ETH"?["ERC20"]:o.value==="BTC"?["BTC"]:[]),H=j(()=>{if(o.value==="USDT"){if(v.value==="TRC20")return new URL("/assets/USDT-TRC20.nefzOlJh.png",import.meta.url).href;if(v.value==="ERC20")return new URL("/assets/USDT-ERC20.DV68RjSM.png",import.meta.url).href}else{if(o.value==="BTC")return new URL("/assets/BTC.CUVYde77.png",import.meta.url).href;if(o.value==="ETH")return new URL("/assets/ETH.tfTyAzfy.png",import.meta.url).href}return new URL("/assets/USDT-TRC20.nefzOlJh.png",import.meta.url).href}),V=l=>{const t=parseFloat(l);return t>=1?t.toFixed(2):t>=.01?t.toFixed(4):t.toFixed(8)},I=l=>l?new Date(l).toLocaleString():"N/A",O=l=>{o.value=l,w.value=!1,T()},T=async()=>{var l,t,s,n,$;if(o.value==="BANK"){p.value="",x.value="";return}D.value=!0,p.value="",x.value="";try{console.log("Loading deposit address for:",o.value,v.value);const h=await U.get("/deposit/addresses",{params:{currency:o.value,network:v.value}});console.log("Deposit address response:",h.data);const g=h.data.addresses||[];console.log("Found addresses:",g.length,g);const A=g.find(Y=>Y.is_active!==!1)||g[0];A&&A.address?(p.value=A.address,x.value=`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(p.value)}`,console.log("Set deposit address:",p.value.substring(0,20)+"...")):(console.warn("No valid address found. Addresses array:",g),p.value="",x.value="")}catch(h){console.error("Error loading deposit address:",h),console.error("Currency:",o.value,"Network:",v.value),console.error("Error response:",(l=h.response)==null?void 0:l.data),console.error("Full error:",h),(((t=h.response)==null?void 0:t.status)===404||(($=(n=(s=h.response)==null?void 0:s.data)==null?void 0:n.addresses)==null?void 0:$.length)===0)&&console.warn(`No deposit address found for ${o.value} ${v.value}. Please contact admin.`),p.value="",x.value=""}finally{D.value=!1}},Q=async()=>{if(p.value)try{await navigator.clipboard.writeText(p.value),alert("Address copied to clipboard!")}catch(l){console.error("Failed to copy:",l)}},J=l=>{const t=l.target.files[0];if(t){f.value=t;const s=new FileReader;s.onload=n=>{_.value=n.target.result},s.readAsDataURL(t)}},F=async()=>{var l,t,s;try{console.log("Loading deposit history...");const n=await U.get("/deposit/requests");console.log("Deposit history response:",n.data),C.value=n.data.deposits||n.data||[]}catch(n){console.error("Error loading deposit history:",n),console.error("Error response:",(l=n.response)==null?void 0:l.data),console.error("Error status:",(t=n.response)==null?void 0:t.status),console.error("Error message:",n.message),((s=n.response)==null?void 0:s.status)===401?alert("Please login again"):console.error("Failed to load deposit history"),C.value=[]}},W=async()=>{var l,t;if(!b.value||parseFloat(b.value)<=0){alert("Please enter a valid amount");return}if(o.value!=="BANK"&&!f.value){alert("Screenshot is required for crypto deposits");return}y.value=!0;try{const s=new FormData;s.append("currency",o.value==="BANK"?"USDT":o.value),s.append("amount",b.value),s.append("deposit_type",o.value==="BANK"?"bank":"crypto"),o.value!=="BANK"&&v.value&&s.append("network",v.value),f.value&&s.append("screenshot",f.value),await U.post("/deposit/request",s,{headers:{"Content-Type":"multipart/form-data"}}),alert("Deposit request submitted successfully! Waiting for admin approval."),b.value="",f.value=null,_.value=null,F()}catch(s){alert(((t=(l=s.response)==null?void 0:l.data)==null?void 0:t.error)||"Deposit request failed")}y.value=!1};return L(v,()=>{T()}),L(o,()=>{o.value!=="BANK"&&R.value.length>0&&(v.value=R.value[0]),T()}),X(()=>{T(),F()}),(l,t)=>(a(),i("div",re,[N.value?(a(),M(oe,{key:0})):m("",!0),e("div",ne,[N.value?m("",!0):(a(),M(le,{key:0})),e("main",ae,[e("div",ie,[e("div",de,[e("div",ue,[e("button",{onClick:t[0]||(t[0]=s=>l.$router.back()),class:"p-1.5 hover:bg-white/10 rounded-lg transition-colors"},[...t[9]||(t[9]=[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("h1",ce,r(c(d)("deposit.title")),1)]),e("button",{onClick:t[1]||(t[1]=s=>k.value=!0),class:"text-sm text-white/70 hover:text-white transition-colors"},r(c(d)("deposit.history")),1)])]),e("div",ve,[e("div",pe,[e("div",fe,[e("span",he,r(o.value),1),e("button",{onClick:t[2]||(t[2]=s=>w.value=!0),class:"flex items-center gap-1 text-sm text-white/70 hover:text-white transition-colors"},[Z(r(c(d)("deposit.selectCurrency"))+" ",1),t[10]||(t[10]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])])]),o.value!=="BANK"?(a(),i("div",me,[e("div",be,[(a(!0),i(B,null,S(R.value,s=>(a(),i("button",{key:s,onClick:n=>v.value=s,class:q(["flex-1 py-2 px-4 rounded-lg font-medium transition-colors",v.value===s?"bg-blue-500/30 text-blue-200 border border-blue-500/50":"glass-input text-white/70 hover:bg-white/10"])},r(s),11,xe))),128))])])):m("",!0),e("div",we,[D.value?(a(),i("div",ge,[...t[11]||(t[11]=[e("div",{class:"w-32 h-32 rounded-lg bg-white/10 animate-pulse"},null,-1),e("div",{class:"h-3 w-40 bg-white/10 rounded-full animate-pulse"},null,-1),e("div",{class:"h-3 w-56 bg-white/10 rounded-full animate-pulse"},null,-1)])])):p.value?(a(),i(B,{key:1},[e("div",_e,[e("div",ye,[e("img",{src:x.value,alt:"QR Code",class:"w-40 h-40"},null,8,ke),e("div",Ce,[e("div",Te,[e("img",{src:H.value,alt:o.value,class:"w-full h-full object-contain"},null,8,Be)])])])]),e("div",De,[e("p",Re,r(c(d)("deposit.depositAddress")),1),e("div",Ae,[e("p",je,r(p.value),1),e("button",{onClick:Q,class:"px-3 py-1 bg-blue-500/30 text-blue-200 rounded-lg text-xs transition-colors"},r(c(d)("deposit.copy")),1)])])],64)):(a(),i("p",Se,r(c(d)("deposit.noAddressAvailable")||"Deposit address not available for this currency/network."),1))]),e("div",Ue,[e("div",null,[e("label",Ne,r(c(d)("deposit.rechargeQuantity")),1),e("div",Ee,[ee(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>b.value=s),type:"number",step:"0.00000001",class:"flex-1 px-3 py-2 glass-input rounded-lg focus:outline-none text-sm",placeholder:"0.00"},null,512),[[te,b.value]]),e("span",Fe,r(o.value),1)])]),e("div",null,[e("label",$e,r(c(d)("deposit.transferScreenshot")),1),e("input",{type:"file",accept:"image/*",onChange:J,class:"hidden",ref_key:"fileInput",ref:E},null,544),e("input",{type:"text",value:f.value?f.value.name:"Select Picture",readonly:"",onClick:t[4]||(t[4]=s=>{var n;return(n=E.value)==null?void 0:n.click()}),class:"w-full px-3 py-2 glass-input rounded-lg focus:outline-none cursor-pointer text-sm",placeholder:"Select Picture"},null,8,Le),_.value?(a(),i("div",Me,[e("img",{src:_.value,alt:"Preview",class:"w-full h-24 object-cover rounded-lg"},null,8,Pe)])):m("",!0)]),e("button",{onClick:W,disabled:y.value||!b.value||o.value!=="BANK"&&!f.value,class:"w-full py-2.5 bg-blue-500/40 border border-blue-500/60 rounded-lg font-medium text-sm text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed"},r(y.value?c(d)("common.processing"):c(d)("deposit.submitButton")),9,qe),e("p",Ke,r(c(d)("deposit.waitForReview")),1)])])])]),w.value?(a(),i("div",{key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4",onClick:t[6]||(t[6]=P(s=>w.value=!1,["self"]))},[e("div",ze,[e("div",He,[e("h2",Ve,r(c(d)("deposit.selectCurrency")),1),e("button",{onClick:t[5]||(t[5]=s=>w.value=!1),class:"text-white/70 hover:text-white"},[...t[12]||(t[12]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ie,[(a(),i(B,null,S(z,s=>e("button",{key:s.value,onClick:n=>O(s.value),class:"w-full flex items-center justify-between p-4 border-b border-white/10 last:border-b-0 hover:bg-white/5 transition-colors"},[e("span",Qe,r(s.label),1),o.value===s.value?(a(),i("svg",Je,[...t[13]||(t[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):m("",!0)],8,Oe)),64))])])])):m("",!0),k.value?(a(),i("div",{key:2,class:"fixed inset-0 bg-black/50 z-50 flex items-end md:items-center justify-center p-4",onClick:t[8]||(t[8]=P(s=>k.value=!1,["self"]))},[e("div",We,[e("div",Ye,[t[15]||(t[15]=e("h2",{class:"text-lg font-bold text-white"},"Recharge record",-1)),e("button",{onClick:t[7]||(t[7]=s=>k.value=!1),class:"text-white/70 hover:text-white"},[...t[14]||(t[14]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ge,[(a(!0),i(B,null,S(C.value,s=>(a(),i("div",{key:s.id,class:"p-4 border-b border-white/10 last:border-b-0"},[e("div",Xe,[e("div",null,[e("div",Ze,r(s.currency)+" - "+r(V(s.amount)),1),e("div",et,r(I(s.created_at)),1)]),e("span",{class:q(["px-2 py-1 rounded text-xs",s.status==="approved"?"bg-green-500/20 text-green-300":s.status==="rejected"?"bg-red-500/20 text-red-300":"bg-yellow-500/20 text-yellow-300"])},r(s.status),3)])]))),128)),C.value.length===0?(a(),i("div",tt,r(c(d)("deposit.noRecords")),1)):m("",!0)])])])):m("",!0)]))}};export{at as default};
